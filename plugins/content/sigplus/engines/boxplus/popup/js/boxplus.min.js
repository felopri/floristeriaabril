/*
 boxplus: a lightweight pop-up window engine shipped with sigplus
 @author  Levente Hunyadi
 @version 1.4.2
 @remarks Copyright (C) 2009-2010 Levente Hunyadi
 @remarks Licensed under GNU/GPLv3, see http://www.gnu.org/licenses/gpl-3.0.html
 @see     http://hunyadi.info.hu/projects/boxplus
*/
if("undefined"==typeof __jQuery__)var __jQuery__=jQuery;
(function(c){function C(a,b){var c=parseInt(a.css(b));return isNaN(c)?a[b]():c}function r(a){return C(a,"width")}function H(a,b){return parseInt(a.css("margin-"+b))||0}function ya(a){var b=a.attr("src"),c=a.attr("longdesc");a=a.attr("data-thumb");return{src:a?a:b&&"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="!=b?b:/\.(gif|jpe?g|png)$/i.test(c)?c:!1}}function d(a,b){return c(".boxplus-"+a,b)}function X(a){a=c(a);h=c.extend({},Y,a.data("boxplus"));var b=h.theme;
b&&c("link[rel=stylesheet][title^=boxplus]").attr("disabled","disabled").filter('[title="boxplus-'+b+'"]').removeAttr("disabled");O.removeClass("boxplus-hidden");d("m",e).addClass("boxplus-hidden");d("title",e).addClass("boxplus-unavailable");e.removeClass("boxplus-disabled").css({width:P,height:Q}).css(Z(P,Q)).removeClass("boxplus-hidden");D(e,!0);R.bind("keydown",$);h.contextmenu||R.bind("contextmenu",I).bind("dragstart",I);m=(b=a.attr("rel"))?c('a[rel="'+b+'"]'):a;a=a.attr("href");var g=m.map(function(){return c(this).attr("href")}).get();
m=m.filter(function(a){return c.inArray(c(this).attr("href"),g)>=a});w=(ba=h.rtl)?"right":"left";f.empty().css({left:"auto",right:"auto"}).css(w,0);m.each(function(a){var b=c("img:first",this);c("<li />").append((b.size()?c("<img />").attr(ya(b)):c()).click(function(){p();u(a)})).appendTo(f)});x.removeClass("boxplus-disabled").each(function(){var a=c("ul",this);c(this).toggleClass("boxplus-unavailable",2>a.children().size())});b="outside"==h.thumbs;x.toggleClass("boxplus-disabled",!b).filter(l.children()).toggleClass("boxplus-disabled",
b);J.toggleClass("boxplus-unavailable",2>m.length||!h.slideshow);u(c.inArray(a,g))}function S(){p();R.unbind("keydown",$).unbind("contextmenu",I).unbind("dragstart",I);e.stop(!0,!0);k=-1;e.addClass("boxplus-disabled").add(E).add(l).add(O).addClass("boxplus-hidden")}function za(){p();u(0)}function T(){p();u(k-1)}function U(){p();u(k+1)}function Aa(){p();u(m.length-1)}function u(a){var b=m.length;if(a!=k&&(h.loop||0<=a&&a<b))k=(a+b)%b,ca(!0),da()}function p(){y&&(clearTimeout(y),y=0);K.addClass("boxplus-disabled");
J.removeClass("boxplus-disabled")}function Ba(){ea();J.addClass("boxplus-disabled");K.removeClass("boxplus-disabled")}function Ca(){p();ca(!F.hasClass("boxplus-hidden"));da()}function L(){l.addClass("boxplus-hidden");D(l,!1);D(e,!0);E.addClass("boxplus-hidden");var a=h.autofit,b={},g={},aa={};Da(a&&F.hasClass("boxplus-hidden"),b,g,aa);l.css(b);G.attr("src",m.eq(k).attr("href"));M.toggleClass("boxplus-unavailable",!a||!s||b.width==s.width&&F.hasClass("boxplus-hidden"));f.each(function(){c(this).children().removeClass("boxplus-active").eq(k).addClass("boxplus-active")});
d("m",e).addClass("boxplus-hidden");e.animate(c.extend(aa,g),h.duration,h.easing,Ea)}function Fa(){p();window.location.href=h.download(m.eq(k))}function fa(){p();l.children().slice(0,-1).toggleClass("boxplus-hidden")}function ga(a){var b=a.attr("id"),b=b?"boxplus-"+b:"boxplus";c("li",a).each(function(){c("a:first",this).attr("rel",b)});return c("a[rel="+b+"]",a)}function da(){y&&(clearTimeout(y),y=0);e.stop(!0,!0);f.stop();E.addClass("boxplus-hidden");D(l,!0);v.empty();ha.addClass("boxplus-unavailable");
var a=m.eq(k),b=a[0],g=a.attr("href"),d=b.pathname;c.boxplus.onchange(g,k);/^#/.test(g)?(v.append(c(g).clone().contents()),N()):/\.(txt|html?)$/i.test(d)?v.load(g,{},N):/\.(gif|jpe?g|png)$/i.test(d)?ia(a):/\.(mov|mpe?g|ogg|swf|webM|wmv)$/i.test(d)||/youtube\.com$/.test(b.hostname)?ja(a):c.ajax({url:g,success:function(b,c,d){b=d.getResponseHeader("Content-Type");/^text\/(plain|html)/.test(b)?v.load(g,{},N):/^image\/(gif|jpeg|png)/.test(b)?ia(a):/^application\/x-shockwave-flash/.test(b)&&ja(a)},type:"head"})}
function ia(a){var b=h.metadata(a);b&&v.append(0<=c.inArray(c.type(b),["boolean","number","string"])?b:b.clone());G.removeClass("boxplus-unavailable");c(s=new Image).load(L).error(N).attr("src",a.attr("href"))}function ja(a){for(var b=a.attr("href"),g={},d=a[0].search.replace(/^\?/,"").split("&"),e=0;e<d.length;e++)if(d[e]){var f=d[e].split("=");g[f[0]]=f[1]}d=parseInt(g.width)||640;g=parseInt(g.height)||480;g={width:d,height:g};a=a[0].pathname;/\.(ogg|webM)$/i.test(a)?V.attr(c.extend({src:b},g)).removeClass("boxplus-unavailable"):
(d="application/x-shockwave-flash",e="D27CDB6E-AE6D-11cf-96B8-444553540000",/\.mov$/i.test(a)&&(d="video/quicktime",e="02BF25D5-8C17-4B23-BC80-D3488ABDDC6B"),W.empty().append("<object"+ka(c.extend({classid:"clsid:"+e},g))+">"+Ga({movie:b})+"\x3c!--[if lt IE 9]>\x3c!--\x3e<object"+ka(c.extend({type:d,data:b},g))+"></object>\x3c!--<![endif]--\x3e</object>").removeClass("boxplus-unavailable"));s=c.extend({},g);L()}function ka(a){var b="",c;for(c in a)b+=" "+c+'="'+a[c]+'"';return b}function Ga(a){var b=
"",c;for(c in a)b+='<param name="'+c+'" value="'+a[c]+'" />';return b}function N(){s=null;L()}function Ea(){d("m",e).removeClass("boxplus-hidden");var a=z(f.children().eq(k));if(0>n){var b=r(x),c=r(f);f.css(w,-(c<b?z(f.children().eq(0)):Math.min(a,c-b)))}else n=k,f.css(w,-a);A();l.removeClass("boxplus-hidden");a=h.loop;la.toggleClass("boxplus-unavailable",!a&&0==k);ma.toggleClass("boxplus-unavailable",!a&&k>=m.length-1);l.children().removeClass("boxplus-hidden");a=s&&s.src;b=!v.is(":empty");na.toggleClass("boxplus-unavailable",
!h.download(m.eq(k)));oa.toggleClass("boxplus-unavailable",!a||!b);v.addClass("boxplus-hidden");a||!b||fa();D(e,!1);pa(e,!1);a={width:r(e)+d("sideways",e).trueWidth(),height:C(e,"height")+qa(e)};e.animate(a,h.duration,h.easing,function(){E.removeClass("boxplus-hidden");!h.loop&&k>=m.length-1&&p();K.hasClass("boxplus-disabled")||ea()})}function ea(){y=setTimeout(function(){u(k+1)},h.slideshow)}function z(a){var b=a.position().left;return ba?a.offsetParent().width()-a.width()-b:b}function A(){var a=
r(f.parent())-r(f),b=z(f);ra.toggleClass("boxplus-hidden",0<=b);sa.toggleClass("boxplus-hidden",0<a||b<=a)}function ta(){p();var a={};a[w]=-z(f.children().eq(n));f.animate(a,"fast","linear",A);return!1}function Ha(){0<n&&(n--,ta())}function Ia(){0<=n&&n+1<m.size()&&(n++,ta())}function Ja(){if(0>n){p();var a={};a[w]=0;f.animate(a,-4*z(f),"linear",A)}}function Ka(){if(0>n){p();var a=r(x),b=r(f),c=z(f),d=a-b;b+c<a?A():(a={},a[w]=d,f.animate(a,-4*(d-c),"linear",A))}}function ua(){f.stop();A()}function ca(a){d("enlarge",
M).toggleClass("boxplus-hidden",!a);F.toggleClass("boxplus-hidden",a)}function pa(a,b){var c=m.eq(k),e=h.title(c),c=h.description(c,b);d("title",a).toggleClass("boxplus-unavailable",!e).html(e);d("text",a).toggleClass("boxplus-unavailable",!c||c==e).empty().append(c)}function D(a,b){var c=d("progress",a).toggleClass("boxplus-hidden",!b);window.clearInterval(c.data("boxplus"));b&&c.data("boxplus",window.setInterval(function(){c.css("background-position",va=(va-32)%384)},150))}function qa(a){return d("caption",
a).trueHeight()+d("controls",a).trueHeight()}function Z(a,b){var d=c(window).width()/2,e=c(window).height()/2,f=Math.max;return{left:f(0,c(window).scrollLeft()+d-a/2),top:f(0,c(window).scrollTop()+e-b/2)}}function Da(a,b,e,h){c.extend(b,{width:s?s.width:wa,height:s?s.height:xa});pa(d("caption",q.removeClass("boxplus-unavailable")),!0);var k=d("thumbs > ul",q);f.eq(0).children().clone().appendTo(k);d("thumbs",q).each(function(a){a=x.eq(a);c(this).toggleClass("boxplus-disabled",a.hasClass("boxplus-disabled")).toggleClass("boxplus-unavailable",
a.hasClass("boxplus-unavailable"))});var m=d("sideways",q),l=d("main",q),l=l.trueWidth()-r(l)+m.trueWidth(),p=d("viewer",q.css("width",b.width+l)).css(b);if(a)for(var n=c(window).width()-H(B,"left")-H(B,"right"),t=q.outerWidth(!0);t>n;)t=n/t,b.width*=t,b.height*=t,p.css(b),t=q.css("width",b.width+l).outerWidth(!0);n=q.outerHeight(!0);if(a)for(a=c(window).height()-H(B,"top")-H(B,"bottom");n>a;)t=a/n,b.width*=t,b.height*=t,p.css(b),n=q.css("width",b.width+l).outerHeight(!0);e.width=r(q)-m.trueWidth();
e.height=C(q,"height")-qa(q);c.extend(h,Z(q.trueWidth(),n));k.empty();q.addClass("boxplus-unavailable")}function $(a){if(0>c.inArray(a.target.tagName.toLowerCase(),["input","textarea"]))return a=c.inArray(a.which,[27,37,39,36,35]),0>a||[S,T,U,za,Aa][a](),!1}function I(a){return!c("img",f).add(G).filter(a.target).size()}var Y={rtl:!1,theme:!1,autofit:!0,slideshow:0,duration:"slow",easing:"swing",loop:!1,contextmenu:!0,thumbs:"inside",title:function(a){a=c("img:first",a);return a.size()?a.attr("alt"):
""},description:function(a){return a.attr("title")},download:function(a){return!1},metadata:function(a){return""}},h,O,e,q,P,Q,wa,xa,l,G,v,V,W,ha,la,ma,J,K,na,oa,M,F,x,f,ra,sa,E,R=c(document),B,s,m,k=-1,va=0,n=-1,y,ba,w;c.fn.trueWidth=function(){return this.filter(":visible").size()?this.outerWidth(!0):0};c.fn.trueHeight=function(){return this.filter(":visible").size()?this.outerHeight(!0):0};c(function(){function a(a,b){return"<div"+(a?' class="boxplus-'+(c.isArray(a)?a.join(" "):a)+'"':"")+">"+
(b?b:"")+"</div>"}B=c("body");var b=a("prev")+a("next"),g=a("caption",a("title")+a("text")),h=a("controls",b+a("start")+a(["stop","boxplus-disabled"])+a("close")+a("download")+a("metadata")),k="<ul />"+a("rewind")+a("forward"),b=c('<div id="boxplus">'+a(["background","boxplus-hidden"])+a(["dialog","boxplus-hidden"],a("title")+a("main",a(["viewer","boxplus-hidden"],a(["content","boxplus-hidden"])+"<img /><video controls />"+a("flash")+b+a("resizer",a("enlarge")+a(["shrink","boxplus-hidden"]))+a("thumbs",
k)+a("progress"))+a("bottom",a("thumbs",k)+g+h))+a(["sideways","boxplus-disabled"],a("thumbs",k)+h+g)+a("lt")+a("t")+a("rt")+a("l")+a("m")+a("r")+a("lb")+a("b")+a("rb")+a("progress"))+"</div>").appendTo(B);O=d("background",b).click(S);e=d("dialog",b);d("caption",e);E=d("bottom",e).add(d("sideways",e));l=d("viewer",e);v=c("div:first",l);G=c("img:first",l);V=c("video",l);W=d("flash",l);ha=c([G[0],W[0]]).add(V);M=d("resizer",l).click(Ca);F=d("shrink",M);ra=d("rewind",e).click(Ha).hover(Ja,ua);sa=d("forward",
e).click(Ia).hover(Ka,ua);x=d("thumbs",e);f=c("ul",x);la=d("prev",e).click(T);ma=d("next",e).click(U);J=d("start",e).click(Ba);K=d("stop",e).click(p);d("close",e).click(S);na=d("download",e).click(Fa);oa=d("metadata",e).click(fa);wa=r(e);xa=C(e,"height");l.css({height:0,width:0});P=r(e);Q=C(e,"height");q=e.clone().appendTo(b)});c.fn.boxplus=function(a){return this.boxplusConfigure(a).click(function(a){X(a.currentTarget);return!1})};c.fn.boxplusGallery=function(a){ga(this).boxplus(a);return this};
c.fn.boxplusDialog=function(a){X(this.boxplusConfigure(a)[0])};c.fn.boxplusConfigure=function(a){this.data("boxplus",c.extend({},a));return this};c.fn.boxplusGalleryConfigure=function(a){ga(this).boxplusConfigure(a);return this};c.boxplus={change:u,previous:T,next:U,refresh:L,configure:function(a){return c.extend(Y,a)},onchange:c.noop}})(__jQuery__);
